var app = angular.module("app", ["ui.bootstrap", "ServicePetitions", "ngMessages"]); app.controller("LattersCtrl", ["$scope", "Petition", function (t, n) { function e() { 0 !== t.ListTemplates.length ? function () { t.charges.submitTotal = !0; var e = { url: t.IsUpdate ? "/api/LattersApi/UpdateTemplate" : "/api/LattersApi/InsertTemplate", data: { Id: t.model.Id, Name: t.model.Name, Description: t.model.Description, Id_TypeTemplate: t.model.Id_TypeTemplate, Id_Company: 1 === t.model.Id_TypeTemplate ? t.model.Id_Company : null, Exceptions: 2 === t.model.Id_TypeTemplate ? t.Items : null, Templates: t.ListTemplates } }; n.PetitionServer(e.url, !1, e.data).then(function (e) { setTimeout(function () { t.charges.submitTotal = !1, o(), document.location.reload(), t.$apply() }, 2500), t.successNotification.submit = !0 }, function (e) { console.error(e), t.errorsNotification.submit = !0, t.charges.submitTotal = !1 }) }() : t.errorsNotification.files = !0 } function o() { t.model = {}, t.SelectContext = { Id_Cause: null, Id_Skill: null }, t.Items = [], t.newTemplate = { Id_typeLatter: null, Id_TypeNotification: null, Id_DocumentCloud: null }, t.DocumentEdit = null, t.ListTemplates = [], t.charges = { createDocument: !1, getModalDocument: !1, submitTotal: !1 }, t.errorsNotification = { items: !1, files: !1, submit: !1 }, t.successNotification = { submit: !1 } } t.Selects = {}, t.model = {}, t.SelectContext = { Id_Cause: null, Id_Skill: null }, t.Items = [], t.newTemplate = { Id_typeLatter: null, Id_TypeNotification: null, Id_DocumentCloud: null }, t.DocumentEdit = null, t.ListTemplates = [], t.charges = { createDocument: !1, getModalDocument: !1, submitTotal: !1 }, t.errorsNotification = { items: !1, files: !1, submit: !1 }, t.successNotification = { submit: !1 }, t.IsUpdate = !1, t.IdDelete = null, t.initSubmit = function () { t.errorsNotification = { items: !1, files: !1, submit: !1 }, t.FormTemplate.$valid && (2 === t.model.Id_TypeTemplate ? 0 !== t.Items.length ? e() : t.errorsNotification.items = !0 : e()) }, t.AddItem = function () { t.errorsNotification = { items: !1, files: !1 }, (t.SelectContext.Id_Cause || t.SelectContext.Id_Skill || t.SelectContext.Id_City || t.SelectContext.Id_Company) && t.Items.push(t.SelectContext), t.clearAdd() }, t.clearAdd = function () { t.SelectContext = { Id_Cause: null, Id_Skill: null } }, t.CreateNewDocument = function () { t.newTemplate.Id_typeLatter && t.newTemplate.Id_TypeNotification && (t.charges.createDocument = !0, n.PetitionServer("/api/LattersApi/CreateNewDocument", !0, null).then(function (e) { t.newTemplate.Id_DocumentCloud = e, t.ListTemplates.push(t.newTemplate), t.newTemplate = { Id_typeLatter: null, Id_TypeNotification: null, Id_DocumentCloud: null }, t.charges.createDocument = !1 }, function (e) { console.error(e), t.charges.createDocument = !1 })) }, t.GetPremisionFileEdit = function (e) { t.charges.getModalDocument = !0, viewDocumentInModal(e, !0), setTimeout(function () { t.charges.getModalDocument = !1, t.$apply() }, 4e3) }, t.ChargueModalDataEdit = function (e) { n.PetitionServer("/api/LattersApi/SelectTemplate?input=" + e, !0, null).then(function (e) { t.model = { Id: e.Id, Name: e.Name, Description: e.Description, Id_TypeTemplate: e.Id_TypeTemplate, Id_Company: e.Id_Company }, t.Items = e.Exceptions, t.ListTemplates = e.Templates, document.getElementById("BtnUpdateClient").click() }, function (e) { console.error(e) }) }, t.addClient = function () { t.IsUpdate && (o(), t.IsUpdate = !1) }, t.UpdateClient = function () { t.IsUpdate = !0 }, t.ConfirmDelete = function () { n.PetitionServer("/api/LattersApi/DeleteTemplate?input=" + t.IdDelete, !0, null).then(function (e) { document.location.reload() }, function (e) { document.location.reload(), console.error(e) }) }, n.PetitionServer("/api/LattersApi/GetInitTemplate", !0, null).then(function (e) { t.Selects = e, t.IframeContent = e }, function (e) { console.error(e) }) }]);